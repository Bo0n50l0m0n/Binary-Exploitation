# ELF x86 - Race condition
## 1. Source code
```c
#include <stdio.h>
#include <string.h>
#include <sys/ptrace.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdlib.h>
 
#define PASSWORD "/challenge/app-systeme/ch12/.passwd"
#define TMP_FILE "/tmp/tmp_file.txt"
 
int main(void)
{
  int fd_tmp, fd_rd;
  char ch;
 
 
  if (ptrace(PTRACE_TRACEME, 0, 1, 0) < 0)
    {
      printf("[-] Don't use a debugguer !\n");
      abort();
    }
  if((fd_tmp = open(TMP_FILE, O_WRONLY | O_CREAT, 0444)) == -1)
    {
      perror("[-] Can't create tmp file ");
      goto end;
    }
   
  if((fd_rd = open(PASSWORD, O_RDONLY)) == -1)
    {
      perror("[-] Can't open file ");
      goto end;
    }
   
  while(read(fd_rd, &ch, 1) == 1)
    {
      write(fd_tmp, &ch, 1);
    }
  close(fd_rd);
  close(fd_tmp);
  usleep(250000);
end:
  unlink(TMP_FILE);
   
  return 0;
}
```

## 2. Solution

lỗi race condition xuất hiện khi trong 1 tiến trình có đến 2 process cùng lúc thực hiện

https://lightningsecurity.io/blog/race-conditions/

trang web trên có nêu rõ ví dụ về race condition

bây giờ dựa vào code ta hiểu được là chương trình sẽ tạo 1 file `tmp/tmp_file.txt` và sau đó write giá trị từ file `.passwd` ở thư mục hiện hành vào file tmp đó

sau đó chương trình sẽ đóng 2 file lại lúc này việc của chúng ta là vừa `execute file binary` và đồng thời `cat tmp_file.txt` là ta sẽ có được flag của chương trình


<img src="https://i.imgur.com/7Qyn7vQ.png">

<details>
  <summary>FLAG</summary>
  eh-q8dEa8q19f9aF()"2a96q92
</details>