# ELF x86 - Stack buffer overflow basic 3
## 1. Source code
```c
nclude <stdio.h>
#include <sys/time.h>
#include <sys/types.h>
#include <unistd.h>
#include <stdlib.h>
 
void shell(void);
 
int main()
{
 
  char buffer[64];
  int check;
  int i = 0;
  int count = 0;
 
  printf("Enter your name: ");
  fflush(stdout);
  while(1)
    {
      if(count >= 64)
        printf("Oh no...Sorry !\n");
      if(check == 0xbffffabc)
        shell();
      else
        {
            read(fileno(stdin),&i,1);
            switch(i)
            {
                case '\n':
                  printf("\a");
                  break;
                case 0x08:
                  count--;
                  printf("\b");
                  break;
                case 0x04:
                  printf("\t");
                  count++;
                  break;
                case 0x90:
                  printf("\a");
                  count++;
                  break;
                default:
                  buffer[count] = i;
                  count++;
                  break;
            }
        }
    }
}
 
void shell(void)
{
  setreuid(geteuid(), geteuid());
  system("/bin/bash");
}
```

## 2. Solution

hint của bài

`An intermediate level to familiarize yourself with stack overflows`

dựa theo hint của đề thì ta biết được đây là integer overflow, bây giờ ta sẽ vẽ thử stack của chương trình lúc này như thế nào

<img src="https://i.imgur.com/NGGn10L.png">

kết hợp hình với câu lệnh trong source

```c
case 0x08:
	count--;
	printf("\b");
...
default:
	buffer[count] = i;
	count++;
	break;
```

như ta thấy `buffer[count]=i` chính là dòng lệnh để ta có thể ghi giá trị, kết hợp với dòng `count--` ta có thể overwrite được giá trị của biến check trong chương trình

lúc count = 0 thì vị trí mà ta có thể control nằm ở vị trí này

<img src="https://i.imgur.com/kvb3cio.png">

như vậy để có thể overwrite giá trị check = `0xbffffabc` thì ta sẽ lùi về 4 lần (tức là nhập vào `0x8` 4 lần) rồi sau đó ta sẽ truyền giá trị cho nó (truyền theo little endian)

<img src="https://i.imgur.com/HKBMaIb.png">

- payload

`'0x8'*4 + '\xbc\xfa\xff\xbf'`

<img src="https://i.imgur.com/5sS2ctn.png">

<details>
	<summary>FLAG</summary>
	Sm4shM3ify0uC4n
</details>